ALTER PROCEDURE [dbo].[SP_MERGER_NTA_CC_AR]
AS
BEGIN

	IF NOT EXISTS (SELECT * FROM sys.indexes WHERE object_id = OBJECT_ID(N'[NTA].[CC_AR_BCP]') AND name = N'C_IX_CC_AR')
	CREATE CLUSTERED INDEX [C_IX_CC_AR] ON [NTA].[CC_AR_BCP]
	(
	[CC_NBR] ASC
	)WITH ( ONLINE = ON, MAXDOP = 44) ON [PRIMARY]
	
	MERGE [dw_production].[NTA].[CC_AR] AS TARGET
	USING [dw_production].[NTA].[CC_AR_BCP](NOLOCK) AS SOURCE 
	ON ( 
		TARGET.[CC_NBR]= SOURCE.[CC_NBR] 
		)
	WHEN MATCHED THEN
	UPDATE SET 

			   [CC_AR_ID]=SOURCE.[CC_AR_ID]
			  ,[LAST_CC_NBR]=SOURCE.[LAST_CC_NBR]
			  ,[PREV_MO_AVY_ST_CODE]=SOURCE.[PREV_MO_AVY_ST_CODE]
			  ,[GUID]=SOURCE.[GUID]
			  ,[CC_REF_NBR]=SOURCE.[CC_REF_NBR]
			  ,[MAIN_CC_REF_NBR]=SOURCE.[MAIN_CC_REF_NBR]
			  ,[CARD_LVL_CODE]=SOURCE.[CARD_LVL_CODE]
			  ,[CC_NBR]=SOURCE.[CC_NBR]
			  ,[MAIN_CC_NBR]=SOURCE.[MAIN_CC_NBR]
			  ,[MSKD_CC_NBR]=SOURCE.[MSKD_CC_NBR]
			  ,[HASH_CC_NBR]=SOURCE.[HASH_CC_NBR]
			  ,[CST_NMR]=SOURCE.[CST_NMR]
			  ,[MAIN_CST_NMR]=SOURCE.[MAIN_CST_NMR]
			  ,[CARD_BIN_NBR]=SOURCE.[CARD_BIN_NBR]
			  ,[CARD_BR_CODE]=SOURCE.[CARD_BR_CODE]
			  ,[EMBOSS_1_NM]=SOURCE.[EMBOSS_1_NM]
			  ,[EMBOSS_2_NM]=SOURCE.[EMBOSS_2_NM]
			  ,[CARD_PD_ID]=SOURCE.[CARD_PD_ID]
			  ,[BARCODE_NBR]=SOURCE.[BARCODE_NBR]
			  ,[CARD_CHIP_CODE]=SOURCE.[CARD_CHIP_CODE]
			  ,[CARD_TP]=SOURCE.[CARD_TP]
			  ,[CARD_ST_CODE]=SOURCE.[CARD_ST_CODE]
			  ,[CARD_SUB_ST_CODE]=SOURCE.[CARD_SUB_ST_CODE]
			  ,[CARD_ST_CHG_DT]=SOURCE.[CARD_ST_CHG_DT]
			  ,[EMBOSS_CODE]=SOURCE.[EMBOSS_CODE]
			  ,[FRST_EMBOSS_DT]=SOURCE.[FRST_EMBOSS_DT]
			  ,[LAST_EMBOSS_CMD_USR]=SOURCE.[LAST_EMBOSS_CMD_USR]
			  ,[LAST_EMBOSS_CMD_DT]=SOURCE.[LAST_EMBOSS_CMD_DT]
			  ,[LAST_EMBOSS_CMD_TM]=SOURCE.[LAST_EMBOSS_CMD_TM]
			  ,[CARD_DLV_BR_CODE]=SOURCE.[CARD_DLV_BR_CODE]
			  ,[CARD_PST_TP_CODE]=SOURCE.[CARD_PST_TP_CODE]
			  ,[CARD_PST_ADR_IDNX_NBR]=SOURCE.[CARD_PST_ADR_IDNX_NBR]
			  ,[EXPY_DT]=SOURCE.[EXPY_DT]
			  ,[OLD_EXPY_DT]=SOURCE.[OLD_EXPY_DT]
			  ,[RNEW_DT]=SOURCE.[RNEW_DT]
			  ,[CARD_CLS_DT]=SOURCE.[CARD_CLS_DT]
			  ,[FRST_USG_DT]=SOURCE.[FRST_USG_DT]
			  ,[LAST_TXN_DT]=SOURCE.[LAST_TXN_DT]
			  ,[LAST_TXN_AMT]=SOURCE.[LAST_TXN_AMT]
			  ,[LYLT_CARD_1_NBR]=SOURCE.[LYLT_CARD_1_NBR]
			  ,[LYLT_CARD_2_NBR]=SOURCE.[LYLT_CARD_2_NBR]
			  ,[PREV_CC_NBR]=SOURCE.[PREV_CC_NBR]
			  ,[NXT_CC_NBR]=SOURCE.[NXT_CC_NBR]
			  ,[STM_ENTR_DT]=SOURCE.[STM_ENTR_DT]
			  ,[CARD_ENTR_USR_CODE]=SOURCE.[CARD_ENTR_USR_CODE]
			  ,[CARD_UPD_USR_CODE]=SOURCE.[CARD_UPD_USR_CODE]
			  ,[NO_RNEW_CODE]=SOURCE.[NO_RNEW_CODE]
			  ,[PAN_SEQ_NBR]=SOURCE.[PAN_SEQ_NBR]
			  ,[NXT_FEE_DT]=SOURCE.[NXT_FEE_DT]
			  ,[ISSNG_FEE_DT]=SOURCE.[ISSNG_FEE_DT]
			  ,[DWH_PD_ID]=SOURCE.[DWH_PD_ID]
			  ,[STMT_ST_CODE]=SOURCE.[STMT_ST_CODE]
			  ,[STMT_DELQ_PRD_CNT]=SOURCE.[STMT_DELQ_PRD_CNT]
			  ,[FLLW_ST_CODE]=SOURCE.[FLLW_ST_CODE]
			  ,[BILL_TP_CODE]=SOURCE.[BILL_TP_CODE]
			  ,[BILL_CYC_CODE]=SOURCE.[BILL_CYC_CODE]
			  ,[NEW_BILL_CYC_CODE]=SOURCE.[NEW_BILL_CYC_CODE]
			  ,[SUPLMNTRY_LMT_RATE]=SOURCE.[SUPLMNTRY_LMT_RATE]
			  ,[SUPLMNTRY_EXPRS_LMT_RATE]=SOURCE.[SUPLMNTRY_EXPRS_LMT_RATE]
			  ,[AC_LMT_AMT]=SOURCE.[AC_LMT_AMT]
			  ,[AC_OLD_LMT_AMT]=SOURCE.[AC_OLD_LMT_AMT]
			  ,[LMT_UPD_DT]=SOURCE.[LMT_UPD_DT]
			  ,[LMT_UPD_USR_CODE]=SOURCE.[LMT_UPD_USR_CODE]
			  ,[CC_OFF_LMT_AMT]=SOURCE.[CC_OFF_LMT_AMT]
			  ,[FRST_DLAY_DT]=SOURCE.[FRST_DLAY_DT]
			  ,[OLMT_CNTER]=SOURCE.[OLMT_CNTER]
			  ,[FNC_TP]=SOURCE.[FNC_TP]
			  ,[AVY_ST_CNT]=SOURCE.[AVY_ST_CNT]
			  ,[APL_NBR]=SOURCE.[APL_NBR]
			  ,[APL_CNL_CODE]=SOURCE.[APL_CNL_CODE]
			  ,[MAIN_OPRN_CNL_CODE]=SOURCE.[MAIN_OPRN_CNL_CODE]
			  ,[ACQM_TP]=SOURCE.[ACQM_TP]
			  ,[OFF_PIN_ST]=SOURCE.[OFF_PIN_ST]
			  ,[PIN_SCP_ST]=SOURCE.[PIN_SCP_ST]
			  ,[CHG_TM]=SOURCE.[CHG_TM]
			  ,[RCRD_ST]=SOURCE.[RCRD_ST]
			  ,[LAST_UPD_DT]=SOURCE.[LAST_UPD_DT]
			  ,[SRC_DT]=SOURCE.[SRC_DT]
			  ,[UPD_DT]=SOURCE.[UPD_DT]
			  ,[LAST_EMBOSS_DT]=SOURCE.[LAST_EMBOSS_DT]
			  ,[FRST_SALE_DT]=SOURCE.[FRST_SALE_DT]
			  ,[FRST_CASH_ADVNC_DT]=SOURCE.[FRST_CASH_ADVNC_DT]
			  ,[FRST_SALE_TXN_ID]=SOURCE.[FRST_SALE_TXN_ID]
			  ,[FRST_CASH_ADVNC_TXN_ID]=SOURCE.[FRST_CASH_ADVNC_TXN_ID]
			  ,[RCRD_ENTR_DT]=SOURCE.[RCRD_ENTR_DT]
			  ,[CC_STAT_ISRT_DT]=SOURCE.[CC_STAT_ISRT_DT]
			  ,[CC_STAT_UPD_DT]=SOURCE.[CC_STAT_UPD_DT]
			  ,[CC_STAT_OL_ISRT_DT]=SOURCE.[CC_STAT_OL_ISRT_DT]
			  ,[CC_STAT_OL_UPD_DT]=SOURCE.[CC_STAT_OL_UPD_DT]
			  ,[FM_CC_NBR]=SOURCE.[FM_CC_NBR]
			  ,[TO_CC_NBR]=SOURCE.[TO_CC_NBR]
			  ,[OWN_NM]=SOURCE.[OWN_NM]
			  ,[OWN_MDL_NM]=SOURCE.[OWN_MDL_NM]
			  ,[OWN_SURNM]=SOURCE.[OWN_SURNM]
			  ,[CC_LMT_UPD_DT]=SOURCE.[CC_LMT_UPD_DT]
			  ,[CC_LMT_ISRT_DT]=SOURCE.[CC_LMT_ISRT_DT]
			  ,MFR_NBR=SOURCE.MFR_NBR



	WHEN NOT MATCHED THEN
	Insert
	(
			   [CC_AR_ID]
			  ,[LAST_CC_NBR]
			  ,[PREV_MO_AVY_ST_CODE]
			  ,[GUID]
			  ,[CC_REF_NBR]
			  ,[MAIN_CC_REF_NBR]
			  ,[CARD_LVL_CODE]
			  ,[CC_NBR]
			  ,[MAIN_CC_NBR]
			  ,[MSKD_CC_NBR]
			  ,[HASH_CC_NBR]
			  ,[CST_NMR]
			  ,[MAIN_CST_NMR]
			  ,[CARD_BIN_NBR]
			  ,[CARD_BR_CODE]
			  ,[EMBOSS_1_NM]
			  ,[EMBOSS_2_NM]
			  ,[CARD_PD_ID]
			  ,[BARCODE_NBR]
			  ,[CARD_CHIP_CODE]
			  ,[CARD_TP]
			  ,[CARD_ST_CODE]
			  ,[CARD_SUB_ST_CODE]
			  ,[CARD_ST_CHG_DT]
			  ,[EMBOSS_CODE]
			  ,[FRST_EMBOSS_DT]
			  ,[LAST_EMBOSS_CMD_USR]
			  ,[LAST_EMBOSS_CMD_DT]
			  ,[LAST_EMBOSS_CMD_TM]
			  ,[CARD_DLV_BR_CODE]
			  ,[CARD_PST_TP_CODE]
			  ,[CARD_PST_ADR_IDNX_NBR]
			  ,[EXPY_DT]
			  ,[OLD_EXPY_DT]
			  ,[RNEW_DT]
			  ,[CARD_CLS_DT]
			  ,[FRST_USG_DT]
			  ,[LAST_TXN_DT]
			  ,[LAST_TXN_AMT]
			  ,[LYLT_CARD_1_NBR]
			  ,[LYLT_CARD_2_NBR]
			  ,[PREV_CC_NBR]
			  ,[NXT_CC_NBR]
			  ,[STM_ENTR_DT]
			  ,[CARD_ENTR_USR_CODE]
			  ,[CARD_UPD_USR_CODE]
			  ,[NO_RNEW_CODE]
			  ,[PAN_SEQ_NBR]
			  ,[NXT_FEE_DT]
			  ,[ISSNG_FEE_DT]
			  ,[DWH_PD_ID]
			  ,[STMT_ST_CODE]
			  ,[STMT_DELQ_PRD_CNT]
			  ,[FLLW_ST_CODE]
			  ,[BILL_TP_CODE]
			  ,[BILL_CYC_CODE]
			  ,[NEW_BILL_CYC_CODE]
			  ,[SUPLMNTRY_LMT_RATE]
			  ,[SUPLMNTRY_EXPRS_LMT_RATE]
			  ,[AC_LMT_AMT]
			  ,[AC_OLD_LMT_AMT]
			  ,[LMT_UPD_DT]
			  ,[LMT_UPD_USR_CODE]
			  ,[CC_OFF_LMT_AMT]
			  ,[FRST_DLAY_DT]
			  ,[OLMT_CNTER]
			  ,[FNC_TP]
			  ,[AVY_ST_CNT]
			  ,[APL_NBR]
			  ,[APL_CNL_CODE]
			  ,[MAIN_OPRN_CNL_CODE]
			  ,[ACQM_TP]
			  ,[OFF_PIN_ST]
			  ,[PIN_SCP_ST]
			  ,[CHG_TM]
			  ,[RCRD_ST]
			  ,[LAST_UPD_DT]
			  ,[SRC_DT]
			  ,[UPD_DT]
			  ,[LAST_EMBOSS_DT]
			  ,[FRST_SALE_DT]
			  ,[FRST_CASH_ADVNC_DT]
			  ,[FRST_SALE_TXN_ID]
			  ,[FRST_CASH_ADVNC_TXN_ID]
			  ,[RCRD_ENTR_DT]
			  ,[CC_STAT_ISRT_DT]
			  ,[CC_STAT_UPD_DT]
			  ,[CC_STAT_OL_ISRT_DT]
			  ,[CC_STAT_OL_UPD_DT]
			  ,[FM_CC_NBR]
			  ,[TO_CC_NBR]
			  ,[OWN_NM]
			  ,[OWN_MDL_NM]
			  ,[OWN_SURNM]
			  ,[CC_LMT_UPD_DT]
              ,[CC_LMT_ISRT_DT]
			  ,MFR_NBR

		)
	VALUES 
	(
			 SOURCE.[CC_AR_ID]
			,SOURCE.[LAST_CC_NBR]
			,SOURCE.[PREV_MO_AVY_ST_CODE]
			,SOURCE.[GUID]
			,SOURCE.[CC_REF_NBR]
			,SOURCE.[MAIN_CC_REF_NBR]
			,SOURCE.[CARD_LVL_CODE]
			,SOURCE.[CC_NBR]
			,SOURCE.[MAIN_CC_NBR]
			,SOURCE.[MSKD_CC_NBR]
			,SOURCE.[HASH_CC_NBR]
			,SOURCE.[CST_NMR]
			,SOURCE.[MAIN_CST_NMR]
			,SOURCE.[CARD_BIN_NBR]
			,SOURCE.[CARD_BR_CODE]
			,SOURCE.[EMBOSS_1_NM]
			,SOURCE.[EMBOSS_2_NM]
			,SOURCE.[CARD_PD_ID]
			,SOURCE.[BARCODE_NBR]
			,SOURCE.[CARD_CHIP_CODE]
			,SOURCE.[CARD_TP]
			,SOURCE.[CARD_ST_CODE]
			,SOURCE.[CARD_SUB_ST_CODE]
			,SOURCE.[CARD_ST_CHG_DT]
			,SOURCE.[EMBOSS_CODE]
			,SOURCE.[FRST_EMBOSS_DT]
			,SOURCE.[LAST_EMBOSS_CMD_USR]
			,SOURCE.[LAST_EMBOSS_CMD_DT]
			,SOURCE.[LAST_EMBOSS_CMD_TM]
			,SOURCE.[CARD_DLV_BR_CODE]
			,SOURCE.[CARD_PST_TP_CODE]
			,SOURCE.[CARD_PST_ADR_IDNX_NBR]
			,SOURCE.[EXPY_DT]
			,SOURCE.[OLD_EXPY_DT]
			,SOURCE.[RNEW_DT]
			,SOURCE.[CARD_CLS_DT]
			,SOURCE.[FRST_USG_DT]
			,SOURCE.[LAST_TXN_DT]
			,SOURCE.[LAST_TXN_AMT]
			,SOURCE.[LYLT_CARD_1_NBR]
			,SOURCE.[LYLT_CARD_2_NBR]
			,SOURCE.[PREV_CC_NBR]
			,SOURCE.[NXT_CC_NBR]
			,SOURCE.[STM_ENTR_DT]
			,SOURCE.[CARD_ENTR_USR_CODE]
			,SOURCE.[CARD_UPD_USR_CODE]
			,SOURCE.[NO_RNEW_CODE]
			,SOURCE.[PAN_SEQ_NBR]
			,SOURCE.[NXT_FEE_DT]
			,SOURCE.[ISSNG_FEE_DT]
			,SOURCE.[DWH_PD_ID]
			,SOURCE.[STMT_ST_CODE]
			,SOURCE.[STMT_DELQ_PRD_CNT]
			,SOURCE.[FLLW_ST_CODE]
			,SOURCE.[BILL_TP_CODE]
			,SOURCE.[BILL_CYC_CODE]
			,SOURCE.[NEW_BILL_CYC_CODE]
			,SOURCE.[SUPLMNTRY_LMT_RATE]
			,SOURCE.[SUPLMNTRY_EXPRS_LMT_RATE]
			,SOURCE.[AC_LMT_AMT]
			,SOURCE.[AC_OLD_LMT_AMT]
			,SOURCE.[LMT_UPD_DT]
			,SOURCE.[LMT_UPD_USR_CODE]
			,SOURCE.[CC_OFF_LMT_AMT]
			,SOURCE.[FRST_DLAY_DT]
			,SOURCE.[OLMT_CNTER]
			,SOURCE.[FNC_TP]
			,SOURCE.[AVY_ST_CNT]
			,SOURCE.[APL_NBR]
			,SOURCE.[APL_CNL_CODE]
			,SOURCE.[MAIN_OPRN_CNL_CODE]
			,SOURCE.[ACQM_TP]
			,SOURCE.[OFF_PIN_ST]
			,SOURCE.[PIN_SCP_ST]
			,SOURCE.[CHG_TM]
			,SOURCE.[RCRD_ST]
			,SOURCE.[LAST_UPD_DT]
			,SOURCE.[SRC_DT]
			,SOURCE.[UPD_DT]
			,SOURCE.[LAST_EMBOSS_DT]
			,SOURCE.[FRST_SALE_DT]
			,SOURCE.[FRST_CASH_ADVNC_DT]
			,SOURCE.[FRST_SALE_TXN_ID]
			,SOURCE.[FRST_CASH_ADVNC_TXN_ID]
			,SOURCE.[RCRD_ENTR_DT]
			,SOURCE.[CC_STAT_ISRT_DT]
			,SOURCE.[CC_STAT_UPD_DT]
			,SOURCE.[CC_STAT_OL_ISRT_DT]
			,SOURCE.[CC_STAT_OL_UPD_DT]
			,SOURCE.[FM_CC_NBR]
			,SOURCE.[TO_CC_NBR]
			,SOURCE.[OWN_NM]
			,SOURCE.[OWN_MDL_NM]
			,SOURCE.[OWN_SURNM]
			,SOURCE.[CC_LMT_UPD_DT]
			,SOURCE.[CC_LMT_ISRT_DT]
			,SOURCE.MFR_NBR


	);

END



GO


